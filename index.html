<title>Breakout on JS</title>
<style>
body{
    background-color: #111;
}
canvas{
    border: 4px solid white;
    border-bottom: transparent;
    background-color: #000;
    margin: 7rem auto;
    display: block;
}

</style>
<canvas></canvas>
<script>
    //recupero la etiqueta canvas
    const canvas = document.querySelector('canvas');
    //recupero el contexto del canvas para pintar por encima (2D)
    const ctx = canvas.getContext('2d');
    //establezco el tamaño del canvas
    canvas.width = 448;
    canvas.height = 500;

    // ahora creo la función para pintar la pantalla, que se ejecutará cada vez que se refresque o haya un cambio en la pantalla (UN LOOP) En vez de hacer un setTimeOut para que se ejecute cada X segundos, el requestAnimationFrame se ejecutara cada segundo (60 veces x min)

    // VARIABLES PELOTA
    const ballRadius = 3;  // tamaño de la pelota
    // posición de la pelota
    let x = canvas.width / 2;
    let y = canvas.height - 30;
    //dirección y velocidad de la pelota
    let dx = -2;
    let dy = -2;

    // VARIABLES PADDLE
    const paddleHeight = 10; // tamaño paddle (alto)
    const paddleWidth = 50; // tamaño paddle (ancho)
    let paddleX = (canvas.width - paddleWidth) / 2; // posición inicial del paddle (se actualizará con el movimiento)
    let paddleY = canvas.height - paddleHeight - 10;

    function drawBall(){
        ctx.beginPath(); // inicia el trazado
        ctx.arc(x, y, ballRadius, 0, Math.PI*2); // dónde se dibuja la pelota
        ctx.fillStyle = '#fff'; // color
        ctx.fill(); // pintar la pelota
        ctx.closePath(); // cierra el trazado
    }

    function drawPaddle(){
        ctx.fillStyle = 'darkred';
        ctx.fillRect(
            paddleX, 
            paddleY, 
            paddleWidth, 
            paddleHeight);
    }
    function drawBricks(){    }

    function collisionDetection(){}
    function ballMovement(){
        // rebotar en las paredes laterales
        if (
            x + dx > canvas.width - ballRadius || // pared derecha
            x + dx < ballRadius // pared izquierda
        ){
            dx = -dx;
        }

        // rebotar en la superior
        if(y + dy < ballRadius){
            dy = -dy;
        }

        // game over si cae abajo

        if(y + dy > canvas.height - ballRadius){
            console.log('Game Over');
            document.location.reload();
        }
        x += dx;    // movimiento lateral
        y += dy;    // movimiento vertical
    }
    function paddleMovement(){}

    function draw(){
        // esta función chequea constantemente las colisiones y en función de eso, irá pintando el "tablero". 

        // Limpiar el canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Dibujo todos los elementos
        drawBall();
        drawPaddle();
        drawBricks();

        // ahora chequeo las colisiones y movimientos
        collisionDetection();
        ballMovement();
        paddleMovement();

        window.requestAnimationFrame(draw);
    }
    draw();

</script>